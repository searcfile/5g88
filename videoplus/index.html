<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>5G88 Video Hub</title>
<style>
  :root{
    --bg:#0b0b0f; --card:#121218; --text:#e9e9ef; --muted:#a4a4b0;
    --gold:#ffd166; --gold-2:#ffcf4d; --line:#242433; --accent:#60a5fa;
    --danger:#ef4444; --ok:#22c55e;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);font:14px/1.45 Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{height:100%;display:grid;grid-template-rows:auto 1fr}
  /* Header */
  .header{position:sticky;top:0;z-index:20;display:flex;gap:10px;align-items:center;padding:10px 14px;border-bottom:1px solid var(--line);background:linear-gradient(180deg,#0e0e14,#0a0a0f)}
  .brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.4px}
  .brand .dot{width:10px;height:10px;border-radius:50%;background:linear-gradient(180deg,var(--gold),var(--gold-2));box-shadow:0 0 12px var(--gold)}
  .brand span{font-size:16px}
  .grow{flex:1 1 auto}
  .search{position:relative;max-width:560px;flex:1}
  .search input{width:100%;height:36px;border-radius:999px;border:1px solid var(--line);background:#0b0b10;color:var(--text);padding:0 40px 0 14px;outline:none}
  .search .icon{position:absolute;right:8px;top:50%;transform:translateY(-50%);opacity:.8}
  .btn{height:36px;padding:0 14px;border-radius:10px;border:1px solid var(--line);background:#11131a;color:var(--text);cursor:pointer}
  .btn:hover{border-color:#2f2f42}
  .btn.gold{border-color:rgba(255,209,102,.25);background:linear-gradient(180deg,#1a1510,#15110b)}
  .btn.gold:focus,.btn.gold:hover{box-shadow:0 0 0 2px rgba(255,209,102,.15)}
  .btn.ghost{background:transparent}
  .toggle{display:flex;align-items:center;gap:8px}
  .toggle input{width:42px;height:22px;border-radius:999px;appearance:none;background:#2a2a3a;position:relative;outline:none;cursor:pointer}
  .toggle input:checked{background:linear-gradient(180deg,#2c4,#1a2)}
  .toggle input::after{content:"";position:absolute;top:3px;left:3px;width:16px;height:16px;border-radius:50%;background:#fff;transition:transform .18s}
  .toggle input:checked::after{transform:translateX(20px)}

  /* Layout */
  .main{display:grid;grid-template-columns:1.5fr 1fr;gap:14px;padding:14px;height:calc(100vh - 58px);}
  .player-card,.list-card{background:linear-gradient(180deg,#111318,#0c0e13);border:1px solid var(--line);border-radius:14px;display:flex;flex-direction:column;min-height:0}
  .card-head{display:flex;align-items:center;gap:10px;padding:10px 12px;border-bottom:1px solid var(--line)}
  .card-head h3{margin:0;font-size:14px;font-weight:700;color:#d7d7df}
  .card-body{padding:10px;display:flex;flex-direction:column;gap:10px;min-height:0}

  /* Player */
  .player-box{position:relative;border-radius:12px;overflow:hidden;background:#000;border:1px solid #1d1d28}
  video{display:block;width:100%;height:56.25vw;max-height:64vh;background:#000}
  .controls{position:absolute;left:0;right:0;bottom:0;display:flex;align-items:center;gap:8px;padding:8px;background:linear-gradient(180deg,transparent,rgba(0,0,0,.55));}
  .c-btn{height:34px;min-width:34px;border-radius:8px;border:1px solid rgba(255,255,255,.12);background:rgba(18,18,24,.6);backdrop-filter:blur(6px);color:#fff;cursor:pointer}
  .c-btn:hover{background:rgba(24,24,32,.7)}
  .time{margin-left:8px;font-variant-numeric:tabular-nums;color:#ddd}
  .bar{position:relative;height:6px;background:rgba(255,255,255,.15);border-radius:999px;flex:1}
  .bar .prog{position:absolute;height:100%;left:0;top:0;background:linear-gradient(90deg,#ffd166,#60a5fa);border-radius:999px;width:0%}

  /* Double-tap zones */
  .zones{position:absolute;inset:0;display:grid;grid-template-columns:1fr 1fr}
  .zone{position:relative}
  .badge{position:absolute;top:50%;transform:translateY(-50%);padding:8px 10px;border-radius:10px;background:rgba(0,0,0,.55);border:1px solid rgba(255,255,255,.15);backdrop-filter:blur(6px);font-weight:800}
  .badge.right{right:10px}
  .badge.left{left:10px}

  /* List */
  .list{flex:1 1 auto;overflow:auto;padding:8px;display:flex;flex-direction:column;gap:10px}
  .item{display:grid;grid-template-columns:auto 1fr auto;gap:10px;align-items:center;border:1px solid var(--line);border-radius:10px;padding:8px;background:#0f1117}
  .thumb{width:90px;height:56px;background:#07080c;border-radius:8px;overflow:hidden;border:1px solid #1b1b27;display:grid;place-items:center}
  .item h4{margin:0;font-size:14px}
  .meta{font-size:12px;color:var(--muted)}
  .pill{padding:2px 8px;border:1px solid var(--line);border-radius:999px;font-size:12px;color:#cfcfe8}
  .item .act{display:flex;gap:8px}
  .empty{opacity:.7;display:grid;place-items:center;height:160px;border:1px dashed #2a2a3a;border-radius:12px}

  /* Uploads */
  .u-row{display:flex;flex-wrap:wrap;gap:8px}
  .file{display:none}
  .hint{font-size:12px;color:var(--muted)}

  /* Responsive */
  @media (max-width: 980px){
    .main{grid-template-columns:1fr;height:auto}
    video{height:50vw;max-height:none}
  }
  @media (max-width: 560px){
    .header{flex-wrap:wrap}
    .search{order:3;width:100%}
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <div class="brand"><span class="dot"></span><span>5G88 Video Hub</span></div>
    <div class="grow"></div>
    <div class="search">
      <input id="searchInput" type="search" placeholder="Search videos by title or notes…" />
      <svg class="icon" width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 21l-4.3-4.3" stroke="#c7c7d7" stroke-width="1.6" stroke-linecap="round"/><circle cx="11" cy="11" r="7" stroke="#c7c7d7" stroke-width="1.6"/></svg>
    </div>
    <label class="toggle"><input id="introToggle" type="checkbox" checked><span>Play Intro</span></label>
    <button id="addBtn" class="btn gold">+ Add Videos</button>
    <input id="fileInput" class="file" type="file" accept="video/*" multiple>
  </div>

  <div class="main">
    <section class="player-card">
      <div class="card-head"><h3>Player</h3><span class="hint" id="nowPlayingHint"></span><div class="grow"></div>
        <label class="btn ghost" for="introFile">Set Intro</label>
        <input id="introFile" class="file" type="file" accept="video/*">
      </div>
      <div class="card-body">
        <div class="player-box">
          <video id="vid" preload="metadata"></video>
          <div class="zones">
            <div class="zone" data-side="left"></div>
            <div class="zone" data-side="right"></div>
            <div id="badgeL" class="badge left" style="display:none">-10s</div>
            <div id="badgeR" class="badge right" style="display:none">+10s</div>
          </div>
          <div class="controls">
            <button id="playBtn" class="c-btn" title="Play/Pause">▶</button>
            <button id="muteBtn" class="c-btn" title="Mute">🔊</button>
            <div class="time"><span id="cur">00:00</span> / <span id="dur">00:00</span></div>
            <div class="bar" id="bar"><div class="prog" id="prog"></div></div>
            <button id="fsBtn" class="c-btn" title="Fullscreen">⤢</button>
          </div>
        </div>
        <div class="hint">💡 Double‑tap right to skip forward 10s (multiple taps stack: 20s, 30s…). Double‑tap left to go back.</div>
      </div>
    </section>

    <section class="list-card">
      <div class="card-head"><h3>Library</h3><div class="grow"></div>
        <button id="clearBtn" class="btn ghost" title="Clear in-memory playlist">Clear</button>
      </div>
      <div class="card-body">
        <div id="list" class="list"></div>
        <div id="empty" class="empty" style="display:none">No videos yet. Click <b>+ Add Videos</b> to upload.</div>
      </div>
    </section>
  </div>
</div>

<script>
(() => {
  // ===== State =====
  const $ = s => document.querySelector(s);
  const vid = $('#vid');
  const listEl = $('#list');
  const emptyEl = $('#empty');
  const nowPlayingHint = $('#nowPlayingHint');
  const searchInput = $('#searchInput');
  const introToggle = $('#introToggle');

  let PLAYLIST = [];
  let INTRO_URL = null; // objectURL for intro (session only)
  let queueAfterIntro = null; // item to play after intro

  // ===== Helpers =====
  const fmt = s => isFinite(s) ? new Date(s*1000).toISOString().substr(14,5) : '00:00';
  const setBadge = (side, amount) => {
    const el = side==='right' ? $('#badgeR') : $('#badgeL');
    el.textContent = (side==='right'?'+':'-') + amount + 's';
    el.style.display = 'block';
    clearTimeout(el._t);
    el._t = setTimeout(()=> el.style.display='none', 450);
  };

  function renderList(filter=''){
    listEl.innerHTML = '';
    const q = filter.trim().toLowerCase();
    const rows = PLAYLIST.filter(it => !q || (it.title.toLowerCase().includes(q) || (it.notes||'').toLowerCase().includes(q)));
    rows.forEach((it, idx) => listEl.appendChild(renderItem(it, idx)));
    emptyEl.style.display = rows.length ? 'none' : 'grid';
  }

  function renderItem(it, idx){
    const item = document.createElement('div');
    item.className='item';
    item.innerHTML = `
      <div class="thumb">🎬</div>
      <div>
        <h4 contenteditable="true" data-idx="${idx}" class="title">${escapeHtml(it.title)}</h4>
        <div class="meta">${(it.sizeMB||0).toFixed(1)} MB • ${it.type || ''}</div>
        <div class="meta">Notes: <span contenteditable="true" data-idx="${idx}" class="notes">${escapeHtml(it.notes||'')}</span></div>
      </div>
      <div class="act">
        <button class="btn" data-play="${idx}">Play</button>
        <button class="btn" data-del="${idx}">Delete</button>
      </div>`;

    item.querySelector('[data-play]').addEventListener('click', () => playItem(idx));
    item.querySelector('[data-del]').addEventListener('click', () => delItem(idx));

    item.querySelector('.title').addEventListener('input', (e)=>{
      PLAYLIST[idx].title = e.target.textContent.trim();
      persistTmp();
    });
    item.querySelector('.notes').addEventListener('input', (e)=>{
      PLAYLIST[idx].notes = e.target.textContent.trim();
      persistTmp();
    });
    return item;
  }

  function escapeHtml(str){
    return String(str).replace(/[&<>"]+/g, s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[s]));
  }

  function persistTmp(){
    // Store lightweight metadata (not blobs). Object URLs won't survive reload.
    localStorage.setItem('videohub.meta', JSON.stringify(PLAYLIST.map(({title, notes, type, sizeMB})=>({title, notes, type, sizeMB}))));
  }

  function hydrateFromMeta(){
    const meta = JSON.parse(localStorage.getItem('videohub.meta')||'[]');
    if(meta.length && !PLAYLIST.length){
      // show placeholders to remind user to re‑add files
      PLAYLIST = meta.map(m=>({ ...m, url: null }));
    }
  }

  // ===== Player logic =====
  let tapping = { left: {count:0,t:0}, right: {count:0,t:0} };
  const TAP_MS = 280; // double-tap window per side
  function onTap(side){
    const obj = tapping[side];
    const now = performance.now();
    if (now - obj.t < TAP_MS) obj.count++; else obj.count = 1;
    obj.t = now;
    const jump = obj.count * 10; // stack 10s each quick tap
    setBadge(side, jump);
    if(side==='right') vid.currentTime = Math.min((vid.currentTime||0) + jump, vid.duration || 9e9);
    else vid.currentTime = Math.max((vid.currentTime||0) - jump, 0);
  }

  // queue intro, then main
  function playWithOptionalIntro(src, label){
    if (INTRO_URL && introToggle.checked) {
      queueAfterIntro = {src,label};
      vid.src = INTRO_URL;
      vid.play().catch(()=>{});
    } else {
      queueAfterIntro = null;
      vid.src = src;
      vid.play().catch(()=>{});
    }
    nowPlayingHint.textContent = label ? `Now Playing: ${label}` : '';
  }

  function playItem(idx){
    const it = PLAYLIST[idx];
    if(!it.url){ alert('This item is a placeholder from previous session. Please re‑add the file.'); return; }
    playWithOptionalIntro(it.url, it.title);
  }

  function delItem(idx){
    const it = PLAYLIST[idx];
    try{ it.url && URL.revokeObjectURL(it.url);}catch(e){}
    PLAYLIST.splice(idx,1);
    persistTmp();
    renderList(searchInput.value);
  }

  // controls
  const playBtn = $('#playBtn');
  const muteBtn = $('#muteBtn');
  const fsBtn = $('#fsBtn');
  const curEl = $('#cur');
  const durEl = $('#dur');
  const bar = $('#bar');
  const prog = $('#prog');

  function updateTimes(){
    curEl.textContent = fmt(vid.currentTime|0);
    durEl.textContent = fmt((vid.duration||0)|0);
    const p = (vid.currentTime||0) / (vid.duration||1) * 100;
    prog.style.width = p + '%';
  }

  playBtn.addEventListener('click', ()=>{ vid.paused? vid.play(): vid.pause(); });
  muteBtn.addEventListener('click', ()=>{ vid.muted = !vid.muted; muteBtn.textContent = vid.muted? '🔈':'🔊';});
  fsBtn.addEventListener('click', ()=>{
    const box = document.querySelector('.player-box');
    if(document.fullscreenElement) document.exitFullscreen(); else box.requestFullscreen?.();
  });
  vid.addEventListener('play', ()=> playBtn.textContent = '⏸');
  vid.addEventListener('pause', ()=> playBtn.textContent = '▶');
  vid.addEventListener('timeupdate', updateTimes);
  vid.addEventListener('loadedmetadata', updateTimes);
  bar.addEventListener('click', (e)=>{
    const r = bar.getBoundingClientRect();
    const x = (e.clientX - r.left)/r.width; vid.currentTime = x * (vid.duration||0);
  });

  // After intro ends, continue queued main
  vid.addEventListener('ended', ()=>{
    if(queueAfterIntro){
      const {src,label} = queueAfterIntro; queueAfterIntro=null; vid.src = src; vid.play().catch(()=>{}); nowPlayingHint.textContent = `Now Playing: ${label}`;
    }
  });

  // Tap zones (mobile + desktop double clicks)
  document.querySelectorAll('.zone').forEach(z => {
    const side = z.dataset.side;
    // touch
    z.addEventListener('touchstart', (e)=>{ e.preventDefault(); onTap(side); }, {passive:false});
    // mouse double-click
    z.addEventListener('dblclick', (e)=>{ e.preventDefault(); onTap(side); });
  });

  // keyboard
  window.addEventListener('keydown', (e)=>{
    if(['ArrowRight','l','L'].includes(e.key)) onTap('right');
    if(['ArrowLeft','j','J'].includes(e.key)) onTap('left');
    if(e.key==='k' || e.code==='Space'){ e.preventDefault(); vid.paused?vid.play():vid.pause(); }
  });

  // ===== Uploads =====
  $('#addBtn').addEventListener('click', ()=> $('#fileInput').click());
  $('#fileInput').addEventListener('change', (e)=>{
    const files = Array.from(e.target.files||[]);
    if(!files.length) return;
    const items = files.map(f=>({
      title: f.name.replace(/\.[^.]+$/, ''),
      url: URL.createObjectURL(f),
      type: f.type || 'video',
      sizeMB: f.size/1_000_000,
      notes: ''
    }));
    PLAYLIST.push(...items);
    persistTmp();
    renderList(searchInput.value);
    if(vid.src === '' && items[0]) playItem(PLAYLIST.length - items.length); // autoplay first if empty
    e.target.value = '';
  });

  $('#introFile').addEventListener('change', (e)=>{
    const f = (e.target.files||[])[0];
    if(!f) return; if(INTRO_URL) { try{URL.revokeObjectURL(INTRO_URL);}catch{}}
    INTRO_URL = URL.createObjectURL(f);
    e.target.value='';
  });

  // Search
  searchInput.addEventListener('input', (e)=> renderList(e.target.value));

  // Clear
  $('#clearBtn').addEventListener('click', ()=>{
    if(!confirm('Clear playlist for this session?')) return;
    PLAYLIST.forEach(it=>{ try{it.url && URL.revokeObjectURL(it.url);}catch{} });
    PLAYLIST = [];
    persistTmp();
    renderList(searchInput.value);
    vid.removeAttribute('src'); vid.load(); nowPlayingHint.textContent='';
  });

  // ===== Bootstrap =====
  hydrateFromMeta();

  // Provide a default demo video (network required)
  const DEMO = {
    title: 'Sample: Big Buck Bunny',
    url: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4',
    type: 'video/mp4',
    sizeMB: 33.0,
    notes: 'Demo clip • replace with your own'
  };
  if(PLAYLIST.length===0){ PLAYLIST.push({...DEMO}); }

  renderList('');
  playItem(0);
})();
</script>
</body>
</html>
